<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>MSN-AI - Windows Live Messenger with AI</title>
    <link rel="icon" type="image/png" href="assets/general/logo.png" />
    <link rel="stylesheet" href="styles.css" />
    <!-- Highlight.js para resaltado de sintaxis -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.10.0/build/styles/github.min.css">

</head>

<body>
    <div class="main">
        <!-- Panel de chats (izquierdo) -->
        <div class="mainwindow" id="chats-panel">
            <div class="header">
                <div class="titlebar">
                    <img src="assets/general/live_logo.png" alt="Windows Live Logo">
                    <img id="title" src="assets/general/title_text.png">
                </div>
                <div class="ai-info">
                    <div class="ai-avatar-container">
                        <img id="ai-avatar" src="assets/images/profile.jpeg" alt="AI Avatar">
                        <img id="ai-avatar-frame" src="assets/background/frame_48.png">
                    </div>
                    <div class="ai-profile">
                        <button class="aerobutton" id="ai-status-btn">
                            <h3 data-i18n="app_description">MSN-AI Asistente de IA</h3>
                            <div style="display: flex; align-items: center; gap: 4px; width: 100%;">
                                <img id="status-icon" src="assets/status/online.png" alt="Estado" style="width: 16px; height: 16px;">
                                <p id="ai-connection-status" style="margin: 0; font-size: 8pt; color: #b9dde7;">(Online)</p>
                                <img class="arrowdown arrowchats" src="assets/general/small_arrow_lightblue.svg" style="margin-left: auto;">
                            </div>
                        </button>
                        <!-- Men√∫ desplegable de estados -->
                        <div id="status-menu" class="emoticon-picker" style="display:none; position:absolute; top:100%; left:0; z-index:1001; background:white; border:1px solid #ccc; padding:8px; box-shadow:0 2px 6px rgba(0,0,0,0.2);">
                            <div class="status-option" data-status="online" style="display:flex; align-items:center; gap:4px; cursor:pointer; padding:4px;">
                                <img src="assets/status/online.png" alt="Online" style="width:16px; height:16px;">
                                <span data-i18n="status.online">Online</span>
                            </div>
                            <div class="status-option" data-status="away" style="display:flex; align-items:center; gap:4px; cursor:pointer; padding:4px;">
                                <img src="assets/status/away.png" alt="Away" style="width:16px; height:16px;">
                                <span data-i18n="status.away">Away</span>
                            </div>
                            <div class="status-option" data-status="busy" style="display:flex; align-items:center; gap:4px; cursor:pointer; padding:4px;">
                                <img src="assets/status/busy.png" alt="Busy" style="width:16px; height:16px;">
                                <span data-i18n="status.busy">Busy</span>
                            </div>
                            <div class="status-option" data-status="invisible" style="display:flex; align-items:center; gap:4px; cursor:pointer; padding:4px;">
                                <img src="assets/status/invisible.png" alt="Invisible" style="width:16px; height:16px;">
                                <span data-i18n="status.invisible">Invisible</span>
                            </div>
                        </div>
                        <button class="aerobutton" id="model-selector">
                            <p style="margin: 0;" id="current-model">Detectando modelo...</p>
                            <img class="arrowdown arrowchats" src="assets/general/small_arrow_lightblue.svg">
                        </button>
                    </div>
                </div>
            </div>

            <div id="chats-nav">
                <ul class="iconbar" id="left">
                    <button class="aerobutton chataction" id="new-chat-btn" data-i18n-title="tooltips.new_chat" title="Nuevo Chat" style="background:url(assets/contacts-window/1131.png) no-repeat center;"></button>
                    <button class="aerobutton chataction" id="import-btn" data-i18n-title="tooltips.export_import" title="Importar Todos los Chats" style="background:url(assets/contacts-window/978.png) no-repeat center;"></button>
                    <button class="aerobutton chataction" id="export-btn" data-i18n-title="tooltips.export_import" title="Exportar Todos los Chats" style="background:url(assets/contacts-window/1484.png) no-repeat center;"></button>
                </ul>
                <ul class="iconbar" id="right">
                    <button class="aerobutton chataction smallarrowbtn" id="settings-btn" data-i18n-title="tooltips.settings" title="Configuraci√≥n del modelo IA">
                        <img src="assets/contacts-window/1489.png" style="height: 16px;">
                        <img class="arrowdown" src="assets/general/small_arrow.svg">
                    </button>
                    <button class="aerobutton chataction" id="order-history-btn" data-i18n-title="buttons.order_history" title="Ordenar Historial" style="background:url(assets/contacts-window/1132.png) no-repeat center;"></button>
                </ul>
            </div>

            <div class="chat-search">
                <input id="chat-search-input" type="text" placeholder="Buscar en chats..." data-i18n-placeholder="chat.search_placeholder">
                <button class="searchbar-btn aerobutton" id="export-selected-chats-btn" data-i18n-title="buttons.export_selected" title="Exportar Chats Seleccionados" style="background:url(assets/contacts-window/1480.png) no-repeat center;"></button>
                <button class="searchbar-btn aerobutton" id="clear-search-btn" data-i18n-title="buttons.clear" title="Limpiar B√∫squeda" style="background:url(assets/contacts-window/329.png) no-repeat center;"></button>
            </div>

            <ul class="chat-list" id="chat-list">
                <!-- Los chats se cargar√°n din√°micamente -->
            </ul>

            <div id="chats-footer">
                <span style="color: #9bb3d4; font-size: 7pt;">MSN-AI v2.1.0 </span>
                <div>
                    <span class="connection-status" id="connection-indicator"></span>
                    <span style="font-size: 7pt;" id="connection-text">Desconectado</span>
                </div>
            </div>
        </div>

        <!-- Panel de chat (derecho) -->
        <div class="mainwindow" id="chat-panel">
            <div class="header">
                <div id="chat-info">
                    <img id="chat-icon" src="assets/chat-window/61.ico">
                    <div id="chat-text">
                        <span id="chat-contact-name">Selecciona un chat</span>
                        <span id="chat-status-message">Bienvenido a MSN-AI</span>
                    </div>
                </div>
                <div id="chat-navbars">
                    <ul class="chatnav" id="left">
                        <button class="aerobutton chat-nav-action" id="decrease-font-size-btn" data-i18n-title="tooltips.decrease_font" title="Disminuir tama√±o del texto" style="background:url(assets/chat-window/1402.png) no-repeat center;"></button>
                        <button class="aerobutton chat-nav-action" id="increase-font-size-btn" data-i18n-title="tooltips.increase_font" title="Aumentar tama√±o del texto" style="background:url(assets/chat-window/1401.png) no-repeat center;"></button>
                        <button class="aerobutton chat-nav-action" id="upload-text-file-btn" data-i18n-title="tooltips.upload_file" title="Subir archivo de texto" style="background:url(assets/chat-window/1403.png) no-repeat center;"></button>
                        <button class="aerobutton chat-nav-action" id="export-current-chat-btn" data-i18n-title="tooltips.export_chat" title="Exportar chat actual" style="background:url(assets/chat-window/1404.png) no-repeat center;"></button>
                        <button class="aerobutton chat-nav-action" id="print-current-chat-btn" data-i18n-title="tooltips.print_chat" title="Imprimir chat actual" style="background:url(assets/chat-window/1405.png) no-repeat center;"></button>
                        <button class="aerobutton chat-nav-action" id="search-current-chat-btn" data-i18n-title="tooltips.search_chat" title="Buscar en el chat actual" style="background:url(assets/chat-window/1406.png) no-repeat center;"></button>
                        <button class="aerobutton chat-nav-action" id="close-current-chat-btn" data-i18n-title="tooltips.close_chat" title="Cerrar chat" style="background:url(assets/chat-window/326.png) no-repeat center;"></button>
                    </ul>
                    <ul class="chatnav" id="right">
                        <button class="aerobutton chat-nav-action smallarrowbtn" id="info-btn" data-i18n-title="menu.info" title="Informaci√≥n">
                            <img src="assets/chat-window/1489.png" style="height: 16px;">
                            <img class="arrowdown" src="assets/general/small_arrow_black.svg">
                        </button>
                        <button class="aerobutton chat-nav-action" id="clear-current-chat-btn" data-i18n-title="buttons.clear_chat" title="Limpiar chat" style="background:url(assets/chat-window/329.png) no-repeat center;"></button>
                    </ul>
                </div>
            </div>

            <div class="conversation">
                <div id="messages-container">
                    <div id="messages-display">
                        <div id="ai-thinking">
                            <img src="assets/chat-window/1539.png" alt="">
                            <p class="thinking-dots"><span data-i18n="chat.ai_thinking">La IA est√° pensando</span><span id="dots">...</span></p>
                        </div>
                        <div id="messages-area">
                            <div class="message">
                                <span style="color: #666; font-size: 7pt; font-style: italic;">
                                    Bienvenido a MSN-AI - Tu asistente de IA con la nostalgia de Windows Live Messenger<br>
                                    Selecciona un chat existente o crea uno nuevo para comenzar.
                                </span>
                            </div>
                        </div>
                    </div>

                    <div id="handle"></div>

                    <div id="send-area">
                        <ul id="emoticos-selection">
                            <button class="aerobutton textoption smallarrowbtn" id="emoticon-natural-btn" data-i18n-title="tooltips.emoticon_natural" title="Naturales">
                                <img src="assets/chat-window/412.png">
                                <img class="arrowdown" src="assets/general/small_arrow_black.svg">
                            </button>
                            <button class="aerobutton textoption smallarrowbtn" id="emoticon-amor-btn" data-i18n-title="tooltips.emoticon_love" title="Amor">
                                <img src="assets/chat-window/1487.png">
                                <img class="arrowdown" src="assets/general/small_arrow_black.svg">
                            </button>
                            <button class="aerobutton textoption noarrow" id="enviar-sumbido-btn" data-i18n-title="tooltips.nudge" title="Sumbido" style="background: url(assets/chat-window/414.png) no-repeat center;"></button>
                            <button class="aerobutton textoption noarrow" id="texto-por-voz-btn" data-i18n-title="tooltips.voice_input" title="Dictado" style="background: url(assets/chat-window/992.png) no-repeat center;"></button>
                            <button class="textoption" style="background: url(assets/chat-window/20204.png) no-repeat center; border: none;"></button>
                            <button class="aerobutton textoption noarrow" id="editor-texto-btn" data-i18n-title="tooltips.text_format" title="Editor de Texto" style="background: url(assets/chat-window/411.png) no-repeat center;"></button>
                            <button class="textoption" style="background: url(assets/chat-window/20204.png) no-repeat center; border: none;"></button>
                            <button class="aerobutton textoption noarrow" id="generador-promt-btn" data-i18n-title="tooltips.generate_prompt" title="Generador de Prompt" style="background: url(assets/chat-window/1490.png) no-repeat center;"></button>
                            <button class="aerobutton textoption noarrow" id="gestor-prompts-btn" data-i18n-title="tooltips.manage_prompts" title="Gestor de Prompts" style="background: url(assets/chat-window/1491.png) no-repeat center;"></button>
                            <button class="textoption" style="background: url(assets/chat-window/20204.png) no-repeat center; border: none;"></button>

                            <button class="aerobutton textoption noarrow" id="detener-respuesta-ia-btn" data-i18n-title="buttons.stop_response" title="Detener Respuesta IA" style="background: url(assets/chat-window/330.png) no-repeat center; display: none;"></button>
                        </ul>

                        <textarea id="message-input" placeholder="Escribe tu mensaje aqu√≠..." data-i18n-placeholder="chat.message_placeholder" disabled></textarea>

                        <div id="bottom-controls">
                            <button class="editortab selected">
                                <img src="assets/chat-window/963.png">
                            </button>
                            <button class="editortab unselected">
                                <img src="assets/chat-window/961.png">
                            </button>
                            <div></div>
                                <button id="send-button" disabled><span data-i18n="buttons.send">Enviar</span></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modales -->

    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="settings.title">Configuraci√≥n del Modelo de IA</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div style="padding: 10px 0;">
                <!-- ========== SONIDOS ========== -->
                <div style="margin-bottom: 15px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="sounds-enabled" checked style="margin-right: 8px;">
                        <span data-i18n="settings.sounds_enabled">Activar sonidos</span>
                    </label>
                </div>

                <!-- ========== NOTIFICACIONES DE ESTADO ========== -->
                <div style="margin-bottom: 15px; padding: 10px; background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 4px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="notify-status-changes" checked style="margin-right: 8px;">
                        <span data-i18n="settings.notify_status_changes">Notificar cambios de estado a la IA</span>
                    </label>
                    <p style="margin: 8px 0 0 24px; font-size: 7pt; color: #666; line-height: 1.4;" data-i18n="settings.notify_status_changes_description">
                        Cuando cambies tu estado (Online, Away, Busy, Invisible), la IA ser√° notificada autom√°ticamente en el chat activo.
                    </p>
                </div>

                <!-- ========== SERVIDOR OLLAMA ========== -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: bold;">
                        <span data-i18n="settings.ollama_server">Servidor Ollama</span>:
                    </label>
                    <input
                        type="text"
                        id="ollama-server"
                        placeholder="http://localhost:11434"
                        style="width: 100%; padding: 6px 8px; font-size: 8pt; border: thin solid #c7c7c7; box-sizing: border-box; font-family: Tahoma;">
                    <p style="margin: 4px 0 0 0; font-size: 7pt; color: #666;">
                        <span data-i18n="settings.ollama_server_description">Direcci√≥n del servidor Ollama. D√©jalo vac√≠o para autodetecci√≥n.</span>
                    </p>
                </div>

                <!-- ========== MODELO DE IA ========== -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: bold;">
                        <span data-i18n="settings.select_model">Modelo de IA</span>:
                    </label>
                    <select
                        id="model-select"
                        style="width: 100%; padding: 6px 8px; font-size: 8pt; border: thin solid #c7c7c7; font-family: Tahoma;">
                        <option value="">Cargando modelos...</option>
                    </select>
                    <p style="margin: 4px 0 0 0; font-size: 7pt; color: #666;">
                        <span data-i18n="settings.model_description">Modelo que se usar√° para nuevos chats. Los chats existentes mantienen su modelo.</span>
                    </p>
                </div>

                <!-- ========== IDIOMA DE INTERFAZ ========== -->
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: bold;">
                        <span data-i18n="settings.language">Idioma de la interfaz</span>:
                    </label>
                    <select
                        id="language-select"
                        style="width: 100%; padding: 6px 8px; font-size: 8pt; border: thin solid #c7c7c7; font-family: Tahoma;">
                        <option value="">Cargando idiomas...</option>
                    </select>
                    <p style="margin: 4px 0 0 0; font-size: 7pt; color: #666;">
                        <span data-i18n="settings.language_description">Idioma en el que se mostrar√°n los men√∫s, botones y mensajes del sistema.</span>
                    </p>
                </div>

                <!-- ========== BOTONES ========== -->
                <div style="text-align: right; margin-top: 20px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                    <button class="aerobutton" id="test-connection" style="margin-right: 8px; padding: 6px 12px;">
                        <span data-i18n="buttons.test_connection">üîå Probar Conexi√≥n</span>
                    </button>
                    <button class="aerobutton" id="save-settings" style="padding: 6px 12px; font-weight: bold;">
                        <span data-i18n="buttons.save">üíæ Guardar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="export-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="export_import.export_title">Exportar Chats</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div>
                <p data-i18n="export_import.export_description_full">Exporta todos tus chats en formato JSON para respaldar o migrar.</p>
                <button class="aerobutton" id="download-chats"><span data-i18n="export_import.download_chats">Descargar Chats</span></button>
            </div>
        </div>
    </div>

    <div id="import-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="export_import.import_title">Importar Chats</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div>
                <p data-i18n="export_import.import_description">Selecciona un archivo JSON de chats exportado previamente.</p>
                <input type="file" id="import-file" accept=".json">
                <br><br>
                <button class="aerobutton" id="import-chats-btn"><span data-i18n="buttons.import">Importar</span></button>
            </div>
        </div>
    </div>

    <!-- Modal de resumen de importaci√≥n -->
    <div id="import-summary-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="import_summary.title">Importaci√≥n Completada</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div style="margin-top: 15px;">
                <div id="import-summary-content" style="padding: 10px;">
                    <!-- El contenido se llenar√° din√°micamente -->
                </div>
                <div style="text-align: right; margin-top: 15px;">
                    <button class="aerobutton" id="close-summary-btn"><span data-i18n="buttons.close">Cerrar</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Audio elements para sonidos -->
    <audio id="sound-login" preload="auto">
        <source src="assets/sounds/login.wav" type="audio/wav">
    </audio>
    <audio id="sound-message-in" preload="auto">
        <source src="assets/sounds/message_in.wav" type="audio/wav">
    </audio>
    <audio id="sound-message-out" preload="auto">
        <source src="assets/sounds/message_out.wav" type="audio/wav">
    </audio>
    <audio id="sound-nudge" preload="auto">
        <source src="assets/sounds/nudge.wav" type="audio/wav">
    </audio>
    <audio id="sound-calling" preload="auto">
        <source src="assets/sounds/calling.wav" type="audio/wav">
    </audio>
    <!-- PICKERS DE EMOTICONES -->
    <div id="emoticon-natural-picker" class="emoticon-picker" style="display:none;"></div>
    <div id="emoticon-amor-picker" class="emoticon-picker" style="display:none;"></div>

    <!-- INFO MODAL (si no existe ya) -->
    <div id="info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="info.title">MSN-AI v1.0</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div class="tab-content" id="contact">
                               <h1 data-i18n="info.contact_title">Contacto</h1>
                               <p>
                                   <span data-i18n="info.contact_thanks">Gracias por tu inter√©s en <strong>MSN-AI</strong>.</span>
                               </p>

                               <div class="contact-info">
                                   <p>
                                       <strong data-i18n="info.contact_name">Nombre:</strong> Alan Mac-Arthur Garc√≠a D√≠az
                                   </p>
                                   <p>
                                       <strong data-i18n="info.contact_email">Correo electr√≥nico:</strong>
                                       <a
                                           href="mailto:alan.mac.arthur.garcia.diaz@gmail.com"
                                           >alan.mac.arthur.garcia.diaz@gmail.com</a
                                       >
                                   </p>
                                   <p>
                                       <strong data-i18n="info.contact_project">Proyecto:</strong>
                                       <a
                                           href="https://github.com/mac100185/MSN-AI"
                                           target="_blank"
                                           rel="noopener noreferrer"
                                           >MSN-AI en GitHub</a
                                       >
                                   </p>
                               </div>

                               <p data-i18n="info.contact_message_1">
                                   Este es un proyecto personal de c√≥digo abierto. Por
                                   favor, ten paciencia si la respuesta no es inmediata.
                               </p>
                               <p data-i18n="info.contact_message_2">
                                   Antes de contactar, aseg√∫rate de haber revisado la
                                   documentaci√≥n y el c√≥digo fuente en el repositorio de
                                   GitHub.
                               </p>
                           </div>
        </div>
    </div>
    <!-- Picker de formato de texto -->
    <div id="text-format-picker" class="emoticon-picker" style="display:none;">
      <span data-i18n-title="format.bold" title="Negrita">N</span>
      <span data-i18n-title="format.italic" title="Cursiva">C</span>
      <span data-i18n-title="format.underline" title="Subrayado">S</span>
    </div>

    <!-- Modal de b√∫squeda en chat -->
    <div id="search-chat-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 data-i18n="search_chat.title">Buscar en el Chat</h3>
          <span class="modal-close">&times;</span>
        </div>
        <div style="margin-top: 10px;">
          <input type="text" id="search-term-input" placeholder="Escribe palabra o frase..." style="width:100%; padding:4px; font-size:8pt; border: thin solid #c7c7c7;">
          <div style="margin-top: 10px; text-align: right;">
            <button class="aerobutton" id="do-search-btn"><span data-i18n="buttons.search">Buscar</span></button>
            <button class="aerobutton" id="clear-search-highlight"><span data-i18n="search_chat.clear_button">Limpiar Resaltado</span></button>
          </div>
        </div>
      </div>
    </div>

    <!-- Men√∫ contextual para chats -->
    <div id="chat-context-menu" class="context-menu" style="display: none; position: absolute; z-index: 10000;">
        <ul style="list-style: none; margin: 0; padding: 0;">
            <li id="context-edit-title" class="context-menu-item">
                <img src="assets/contacts-window/1131.png" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;">
                <span></span>
            </li>
            <li id="context-export-chat" class="context-menu-item">
                <img src="assets/contacts-window/1484.png" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;">
                <span></span>
            </li>
            <li id="context-delete-chat" class="context-menu-item">
                <img src="assets/contacts-window/329.png" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;">
                <span></span>
            </li>
        </ul>
    </div>

    <!-- Modal para editar t√≠tulo del chat -->
    <div id="edit-title-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="edit-title-modal-title"></h3>
                <span class="modal-close">&times;</span>
            </div>
            <div style="margin-top: 15px;">
                <label id="edit-title-modal-label" for="new-title-input" style="display: block; margin-bottom: 8px; font-weight: bold;"></label>
                <input type="text" id="new-title-input" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-family: inherit; font-size: 9pt; box-sizing: border-box;">
                <div style="text-align: right; margin-top: 15px;">
                    <button class="aerobutton" id="cancel-edit-title-btn"><span></span></button>
                    <button class="aerobutton" id="confirm-edit-title-btn" style="margin-left: 8px;"><span></span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmaci√≥n para eliminar chat -->
    <div id="delete-chat-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="delete_chat.title">Eliminar chat</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div style="margin-top: 15px;">
                <p data-i18n="delete_chat.message">¬øEst√°s seguro de que deseas eliminar este chat? Esta acci√≥n no se puede deshacer.</p>
                <div style="text-align: right; margin-top: 15px;">
                    <button class="aerobutton" id="cancel-delete-btn"><span data-i18n="buttons.cancel">Cancelar</span></button>
                    <button class="aerobutton" id="confirm-delete-btn" style="margin-left: 8px;"><span data-i18n="buttons.delete">Eliminar</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de conflictos de importaci√≥n -->
    <div id="import-conflict-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="import_conflict.title">Chat Duplicado Detectado</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div style="margin-top: 15px;">
                <div id="conflict-info" style="background: #f0f0f0; padding: 12px; border-radius: 4px; margin-bottom: 15px;">
                    <p style="margin: 5px 0;"><strong>üìã <span data-i18n="import_conflict.chat_title">T√≠tulo</span>:</strong> <span id="conflict-title"></span></p>
                    <p style="margin: 5px 0;"><strong>ü§ñ <span data-i18n="import_conflict.model">Modelo</span>:</strong> <span id="conflict-model"></span></p>
                    <p style="margin: 5px 0;"><strong data-i18n="import_conflict.existing_count">Chat existente</strong>: <span id="conflict-existing-count"></span> <span data-i18n="import_conflict.messages_suffix">mensaje(s)</span></p>
                    <p style="margin: 5px 0;"><strong data-i18n="import_conflict.imported_count">Chat a importar</strong>: <span id="conflict-imported-count"></span> <span data-i18n="import_conflict.messages_suffix">mensaje(s)</span></p>
                </div>

                <div id="conflict-warning" style="background: #fff3cd; padding: 12px; border-radius: 4px; margin-bottom: 15px; display: none;">
                    <p style="margin: 0; color: #856404;" data-i18n="import_conflict.warning">‚ö†Ô∏è <strong>ADVERTENCIA:</strong> El chat a importar tiene MENOS mensajes. Reemplazar causar√≠a p√©rdida de informaci√≥n.</p>
                </div>

                <div style="margin-bottom: 15px;">
                    <p style="font-weight: bold; margin-bottom: 10px;" data-i18n="import_conflict.question">¬øQu√© deseas hacer?</p>

                    <label style="display: block; padding: 8px; margin-bottom: 8px; background: #fff; border: 2px solid #ccc; border-radius: 4px; cursor: pointer;">
                        <input type="radio" name="conflict-action" value="merge" checked style="margin-right: 8px;">
                        <strong data-i18n="import_conflict.option_merge">Unir</strong> - <span data-i18n="import_conflict.option_merge_desc">Combinar ambos chats manteniendo todos los mensajes</span>
                    </label>

                    <label style="display: block; padding: 8px; margin-bottom: 8px; background: #fff; border: 2px solid #ccc; border-radius: 4px; cursor: pointer;" id="replace-option">
                        <input type="radio" name="conflict-action" value="replace" style="margin-right: 8px;">
                        <strong data-i18n="import_conflict.option_replace">Reemplazar</strong> - <span data-i18n="import_conflict.option_replace_desc">Sustituir el chat existente por el importado</span>
                    </label>

                    <label style="display: block; padding: 8px; margin-bottom: 8px; background: #fff; border: 2px solid #ccc; border-radius: 4px; cursor: pointer;">
                        <input type="radio" name="conflict-action" value="skip" style="margin-right: 8px;">
                        <strong data-i18n="import_conflict.option_skip">Omitir</strong> - <span data-i18n="import_conflict.option_skip_desc">No importar este chat</span>
                    </label>

                    <label style="display: block; padding: 8px; background: #fff; border: 2px solid #ccc; border-radius: 4px; cursor: pointer;">
                        <input type="radio" name="conflict-action" value="skip-all" style="margin-right: 8px;">
                        <strong data-i18n="import_conflict.option_skip_all">Omitir todos</strong> - <span data-i18n="import_conflict.option_skip_all_desc">Omitir este y los restantes conflictos</span>
                    </label>
                </div>

                <div style="text-align: right; margin-top: 15px;">
                    <span id="conflict-counter" style="margin-right: 15px; color: #666;" data-i18n-template="import_conflict.counter">Conflicto 1 de 1</span>
                    <button class="aerobutton" id="conflict-apply-btn"><span data-i18n="buttons.apply">Aplicar</span></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Generador de Prompt -->
    <div id="prompt-generator-modal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 data-i18n="prompt_generator.title">Generador de Prompt</h3>
                <span class="modal-close">&times;</span>
            </div>
            <!-- Indicador de modo edici√≥n -->
            <div id="edit-mode-indicator" style="display: none; background: #e3f2fd; border-left: 4px solid #2196f3; padding: 12px; margin: 15px 0; border-radius: 4px;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 20px;">‚úèÔ∏è</span>
                    <div>
                        <strong data-i18n="prompt_manager.editing_prompt" style="color: #1976d2;">Editando Prompt</strong>
                        <p id="editing-prompt-name" style="margin: 4px 0 0 0; font-size: 9pt; color: #555;"></p>
                    </div>
                </div>
                <div style="margin-top: 10px; display: flex; gap: 8px;">
                    <button type="button" class="aerobutton" id="confirm-save-edit" style="background: #2196f3; color: white; padding: 6px 12px; border-radius: 4px;">
                        <span data-i18n="buttons.update">‚úèÔ∏è Actualizar</span>
                    </button>
                    <button type="button" class="aerobutton" id="cancel-edit" style="background: #999; color: white; padding: 6px 12px; border-radius: 4px;">
                        <span data-i18n="buttons.cancel">Cancelar</span>
                    </button>
                </div>
            </div>
            <div style="margin-top: 15px;">
                <form id="promptForm">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="role" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>üë§</span> <span data-i18n="prompt_generator.role">Rol del LLM:</span>
                        </label>
                        <textarea id="role" name="role" rows="3" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Define el rol del LLM (e.g., 'Eres un asistente experto en...')" data-i18n-placeholder="prompt_generator.role_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('role').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="context" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>üìù</span> <span data-i18n="prompt_generator.context">Contexto:</span>
                        </label>
                        <textarea id="context" name="context" rows="3" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Describe el contexto y la situaci√≥n espec√≠fica" data-i18n-placeholder="prompt_generator.context_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('context').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="audience" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>üë•</span> <span data-i18n="prompt_generator.audience">Audiencia:</span>
                        </label>
                        <textarea id="audience" name="audience" rows="2" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Especifica el p√∫blico objetivo" data-i18n-placeholder="prompt_generator.audience_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('audience').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="tasks" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>üìã</span> <span data-i18n="prompt_generator.tasks">Tareas (una por l√≠nea):</span>
                        </label>
                        <textarea id="tasks" name="tasks" rows="4" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="TASK 1: Descripci√≥n de la primera tarea&#10;TASK 2: Descripci√≥n de la segunda tarea" data-i18n-placeholder="prompt_generator.tasks_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('tasks').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="instructions" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>‚ÑπÔ∏è</span> <span data-i18n="prompt_generator.instructions">Instrucciones:</span>
                        </label>
                        <textarea id="instructions" name="instructions" rows="5" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Formato, estilo, idioma y otros par√°metros t√©cnicos" data-i18n-placeholder="prompt_generator.instructions_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('instructions').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="empathy" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>üí¨</span> <span data-i18n="prompt_generator.empathy">Empat√≠a y Tono:</span>
                        </label>
                        <textarea id="empathy" name="empathy" rows="2" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Define el tono emocional y nivel de empat√≠a" data-i18n-placeholder="prompt_generator.empathy_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('empathy').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="clarification" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>‚ùì</span> <span data-i18n="prompt_generator.clarification">Clarificaci√≥n:</span>
                        </label>
                        <textarea id="clarification" name="clarification" rows="2" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Instrucciones sobre c√≥mo pedir aclaraciones al usuario" data-i18n-placeholder="prompt_generator.clarification_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('clarification').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="refinement" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>üîÑ</span> <span data-i18n="prompt_generator.refinement">Refinamiento:</span>
                        </label>
                        <textarea id="refinement" name="refinement" rows="2" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Instrucciones para iterar y mejorar las respuestas" data-i18n-placeholder="prompt_generator.refinement_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('refinement').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="boundaries" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>üö´</span> <span data-i18n="prompt_generator.boundaries">L√≠mites:</span>
                        </label>
                        <textarea id="boundaries" name="boundaries" rows="2" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Restricciones y l√≠mites a considerar" data-i18n-placeholder="prompt_generator.boundaries_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('boundaries').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="consequences" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>‚ö†Ô∏è</span> <span data-i18n="prompt_generator.consequences">Consecuencias:</span>
                        </label>
                        <textarea id="consequences" name="consequences" rows="2" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Consecuencias de no seguir las instrucciones" data-i18n-placeholder="prompt_generator.consequences_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('consequences').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div class="form-group" style="margin-bottom: 15px;">
                        <label for="example" style="display: block; font-weight: bold; margin-bottom: 5px;">
                            <span>üí°</span> <span data-i18n="prompt_generator.example">Ejemplos:</span>
                        </label>
                        <textarea id="example" name="example" rows="3" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Ejemplos de entrada y salida esperada" data-i18n-placeholder="prompt_generator.example_placeholder"></textarea>
                        <button type="button" class="aerobutton" style="margin-top: 5px;" onclick="document.getElementById('example').value=''">
                            <span data-i18n="buttons.clear">Limpiar</span>
                        </button>
                    </div>

                    <div style="text-align: right; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                        <button type="button" class="aerobutton" id="generate-prompt-btn">
                            <span data-i18n="prompt_generator.generate">‚ú® Generar Prompt</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Resultado del Prompt -->
    <div id="prompt-result-modal" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 data-i18n="prompt_generator.result_title">Prompt Generado (Markdown)</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div style="margin-top: 15px;">
                <pre style="background: #f6f8fa; padding: 12px; border: 1px solid #d0d7de; border-radius: 4px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; word-wrap: break-word;"><code id="markdownEditor" class="markdown"></code></pre>
                <div style="text-align: right; margin-top: 10px;">
                    <button type="button" class="aerobutton" id="copyMarkdownButton">
                        <span data-i18n="buttons.copy">üìã Copiar al Chat</span>
                    </button>
                    <button type="button" class="aerobutton" id="save-prompt-btn" style="margin-left: 8px;">
                        <span data-i18n="prompt_generator.save">‚≠ê Guardar Prompt</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Guardar Prompt -->
    <div id="save-prompt-modal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3 data-i18n="prompt_generator.save_prompt_title">Guardar Prompt</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div style="margin-top: 15px; padding: 0 10px 10px;">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="prompt-name" style="display: block; font-weight: bold; margin-bottom: 5px;">
                        <span data-i18n="prompt_generator.prompt_name">Nombre del Prompt:</span>
                    </label>
                    <input type="text" id="prompt-name" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Ingresa un nombre descriptivo" data-i18n-placeholder="prompt_generator.prompt_name_placeholder">
                </div>

                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="prompt-description" style="display: block; font-weight: bold; margin-bottom: 5px;">
                        <span data-i18n="prompt_generator.prompt_description">Descripci√≥n (opcional):</span>
                    </label>
                    <textarea id="prompt-description" rows="2" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Breve descripci√≥n del prop√≥sito" data-i18n-placeholder="prompt_generator.prompt_description_placeholder"></textarea>
                </div>

                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="prompt-category" style="display: block; font-weight: bold; margin-bottom: 5px;">
                        <span data-i18n="prompt_generator.prompt_category">Categor√≠a (opcional):</span>
                    </label>
                    <input type="text" id="prompt-category" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="e.g., Desarrollo, Marketing, Educaci√≥n" data-i18n-placeholder="prompt_generator.prompt_category_placeholder">
                </div>

                <div class="form-group" style="margin-bottom: 15px;">
                    <label for="prompt-tags" style="display: block; font-weight: bold; margin-bottom: 5px;">
                        <span data-i18n="prompt_generator.prompt_tags">Etiquetas (opcional):</span>
                    </label>
                    <input type="text" id="prompt-tags" style="width: 100%; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit; box-sizing: border-box;" placeholder="Separadas por comas: tag1, tag2, tag3" data-i18n-placeholder="prompt_generator.prompt_tags_placeholder">
                </div>

                <div style="text-align: right; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                    <button type="button" class="aerobutton" id="cancel-save-prompt">
                        <span data-i18n="buttons.cancel">Cancelar</span>
                    </button>
                    <button type="button" class="aerobutton" id="confirm-save-prompt" style="margin-left: 8px;">
                        <span data-i18n="buttons.save">üíæ Guardar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Gestor de Prompts -->
    <div id="prompt-manager-modal" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 data-i18n="prompt_manager.title">Mis Prompts Guardados</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div style="margin-top: 15px;">
                <!-- B√∫squeda y filtros -->
                <div style="display: flex; gap: 10px; margin-bottom: 15px; align-items: center; flex-wrap: wrap;">
                    <input type="text" id="prompt-search" placeholder="Buscar prompts..." data-i18n-placeholder="prompt_manager.search_placeholder" style="flex: 1; min-width: 200px; padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit;">
                    <select id="category-filter" style="padding: 8px; border: 1px solid #007bff; border-radius: 4px; font-family: inherit;">
                        <option value="" data-i18n="prompt_manager.all_categories">Todas las categor√≠as</option>
                    </select>
                    <button class="aerobutton" id="refresh-prompts" title="Actualizar lista" data-i18n-title="prompt_manager.refresh">üîÑ</button>
                </div>

                <!-- Informaci√≥n de almacenamiento -->
                <div style="margin-bottom: 15px; padding: 8px; background: #f0f8ff; border: 1px solid #007bff; border-radius: 4px; text-align: center;">
                    <span id="prompts-count" style="font-weight: bold;">0 prompts guardados</span>
                </div>

                <!-- Lista de prompts -->
                <div id="saved-prompts-list" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; min-height: 200px;">
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;">
                        <h4 data-i18n="prompt_manager.no_prompts_title">üìù No tienes prompts guardados</h4>
                        <p data-i18n="prompt_manager.no_prompts_message">Genera un prompt y haz clic en "‚≠ê Guardar Prompt" para comenzar tu colecci√≥n.</p>
                    </div>
                </div>

                <!-- Botones de gesti√≥n -->
                <div style="text-align: right; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                    <button class="aerobutton" id="export-all-prompts" title="Exportar todos los prompts" data-i18n-title="prompt_manager.export_all_tooltip">
                        <span data-i18n="prompt_manager.export_all">üì§ Exportar Todos</span>
                    </button>
                    <button class="aerobutton" id="import-prompts" title="Importar prompts" data-i18n-title="prompt_manager.import_tooltip" style="margin-left: 8px;">
                        <span data-i18n="prompt_manager.import">üì• Importar</span>
                    </button>
                    <button class="aerobutton" id="delete-all-prompts" title="Eliminar todos los prompts" data-i18n-title="prompt_manager.delete_all_tooltip" style="margin-left: 8px; background-color: #ff4d4d;">
                        <span data-i18n="prompt_manager.delete_all">üóëÔ∏è Eliminar Todos</span>
                    </button>
                </div>
                <input type="file" id="import-prompts-file" accept=".json" style="display: none;">
            </div>
        </div>
    </div>

    <!-- Modal de detalles del Prompt -->
    <div id="prompt-details-modal" class="modal">
        <div class="modal-content" style="max-width: 700px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h3 id="details-prompt-name" style="margin: 0;">Detalles del Prompt</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div id="prompt-details-content" style="margin-top: 15px; padding: 0 10px;">
                <!-- El contenido se cargar√° din√°micamente -->
            </div>
            <div style="text-align: right; margin-top: 20px; padding: 10px 10px 10px; border-top: 1px solid #ccc;">
                <button class="aerobutton" id="load-prompt-to-form">
                    <span data-i18n="prompt_manager.load_to_form">üìù Cargar en Formulario</span>
                </button>
                <button class="aerobutton" id="edit-prompt-details" style="margin-left: 8px;">
                    <span data-i18n="prompt_manager.edit_prompt">‚úèÔ∏è Editar</span>
                </button>
                <button class="aerobutton" id="delete-prompt-from-details" style="margin-left: 8px; background-color: #ff4d4d;">
                    <span data-i18n="prompt_manager.delete_prompt">üóëÔ∏è Eliminar</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Overlay para modales -->
    <div id="modal-overlay" class="modal-overlay" style="display: none;"></div>

    <!-- Contenedor de notificaciones -->
    <div id="notification-container" style="position: fixed; top: 20px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none;">
        <!-- Las notificaciones se agregan aqu√≠ din√°micamente -->
    </div>

    <!-- Librer√≠as para renderizado seguro de Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.2/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.10.0/build/highlight.min.js"></script>

    <script src="msn-ai.js"></script>

</body>
</html>
